-(사회자) : 네, 곧 발표가 시작되니 자리에 앉아서 기다려주시기 바랍니다.
네, 안녕하세요.
이번 시간에는 김민중 님께서 지하철 환기실 공조기 고장 감지 모델로 강의를 시작하겠습니다. 발표자 분 앞으로 모시겠습니다.
-(박수)
-(김민중) : 만나서 반갑습니다.
어떻게 점심식사는 맛있게 드셨나요?!
감사합니다.
이 화면 좀 띄워주시겠어요?
안녕하세요. 파이썬을 활용한 데이터 분석 사례라는 제목으로 발표를 진행할 국가수리과학연구소 김민중입니다.
먼저 바쁘신 와중에 참석해 주셔서 감사합니다.
제 소개를 좀 드리겠습니다.
저는 여기에 계신 분들이랑 Background가 좀 다를 수 있다고 생각하는데 저는 개발자는 아니고요. 수학을 전공을 했습니다.
그래서 제가 지금 현재 일하고 있는 곳도 정부출현연구소인 국가수리과학연구소라는 곳에서 근무를 하고 있습니다. 제가 하고 있는 일은 실제 기업체라든지 공공기관이 가지고 있는 산업문제를 발굴하고 이에 대한 수학적인 해결지원을 해 주는 업무를 하고 있습니다.
지금까지는 저희가 국가기관이다 보니까 무료로 진행을 하고 있습니다.
그래서 저희가 지금 현재 교통공사랑 진행했던 문제 해결 사례를 소개해드리는 방식으로 발표를 진행하도록 하겠습니다.
이 사진은 제가 여러분들과 아이스 브레이킹을 하기 위해서 준비한 사진인데요. 제가 근무하는 곳은 국가수리과학연구소인데, 지금 현재 육아휴직 중입니다. 6월 말에 제 딸이 태어나서 저는 지금 얘기를 보고 있습니다. 그래서 오늘 새벽에도 한 시간마다 일어나는 애기에게 분유를 주면서 잠을 조금씩 잤고요.
발표가 끝나고 오후에 제가 원하는 세션에 참석을 하고 또 바로 애기를 보러 가야 됩니다.
-(박수)
감사합니다.
그래서 다음 발표를 이어나가면 Why Pycon & Why Python?이라고 붙여놨는데 파이콘 참석이 올해 처음입니다. 그래서 발표를 결심하게 된 이유는 제가 전공이 수학자인데, 전공 분야의 생태계가 많이 변하고 있습니다. 분명히 개발자는 아니지만 파이썬이라고 하는 데이터 분석 툴을 이용해서 본인의 수학적 연구를 한다거나 저처럼 산업문제를 해결하는 데 파이썬을 활용한다던가, 수학적 생태계가 변화하고 있는 거를 보여드리고자 파이콘에 참석하게 되었습니다.
그리고 왜 파이썬이냐, 라고 하는 제가 타이틀을 달아놨는데 저는 처음에 산업문제, 기업에 있는 데이터분석을 할 때 처음에 알을 먼저 시작했습니다.
알을 먼저 시작했는데 분명히 통계 패키지라든지 알도 패키지가 잘 짜여 있었는데 제가 하고 있는 데이터분석이라고 하는 업무적인 특성상 알은 한계들이 많이 있었습니다.
라이브러리들이 검증되지 않은 부분들도 많이 있었고요.
그리고 사용자 유저라든지 유저층도 파이썬만큼 두텁지 않은 문제가 있어서 저는 일을 하다가 파이썬으로 전향을 했습니다.
그래서 제가 생각하는 파이썬의 장점은 우선 직관적인 코드 문법이 좋았고요.
저도 파이썬을 공부한 지 그렇게 오래 되지 않았기 때문에 새로운 걸 배워야 되는데 파이썬은 공부하기가 쉬었습니다.
그리고 다양한 유저층이 있어서 제가 에러를 낸 코드라든지 제가 궁금한 것들을 구글에 검색을 해서 해결하는 데 유용했습니다.
검증된 패키지들이 파이썬은 많았습니다.
제가 주로 사용하는 넘피, 판다스, 싸이킹런, 텐서플로우, 캐라스 등 제가 굳이 설명을 하지 않아도 다들 아실만한 라이브러리들이 잘 있었습니다. 그래서 제 다음과 같은 순서로 제 발표를 진행하겠습니다.
먼저 파이썬을 활용해서 서울교통공사와 문제를 해결했는데 그래서 도대체 어떠한 문제를 해결했는지 어떠한 데이터분석을 했는지 먼저 제가 소개를 드리겠고요.
교통공사와 공동으로 진행해서 얻었던 결과, 데이터분석 결과, 실적을 소개하는 순으로 발표를 진행하도록 하겠습니다.
먼저 지하철역에는 다음과 같은 기계설비들이 있습니다.
환기, 냉방, 배수 그리고 승강, 엘리베이터, 에스컬레이터, 위생 이런 다양한 기계설비들이 존재하는데 이러한 기계설비들을 자동제어하고 데이터분석을 하기 위해서 서울교통공사에서는 삼바라고 하는 시스템을 자체개발해서 운용하고 있습니다.
보시는 기계설비들에 장착되어 있는 IOT 센서에서 데이터를 수집해서 해당 설비에 대한 자동제어를 하고 있는 상황인데 시스템 구축은 하드웨어 측면에서 다 완료가 됐지만 센싱 데이터를 이용해서 설비의 고장을 감지하거나 예측을 하는 알고리즘이 존재하지 않았습니다.
조금 더 깊게 설명을 드리면 그냥 정말 들어오는 센싱 데이터의 값이 어떠한 값을 넘었는지 안 넘었는지를 가지고 지금 현재 이 상을 판단하는 아주 기본적인 수준의 알고리즘을 구축을 해서 사용을 하고 있는 상태였었습니다.
그래서 이런 해당 이슈를 저희에게 의뢰를 해왔고요.
그래서 저는 공조기 모터에 대한 기계설비들이 다양하게 존재하는데 저희는 공조기 모터에 대한 이상 감지 알고리즘 개발을 공동 연구하기로 했습니다.
아까 말씀드린 것처럼 설비들이 다양한데 모든 설비에 대한 이상 감지 알고리즘을 저희가 만들기는 무리가 있고, 제가 말씀드렸듯이 저희는 무료로 진행하고 있습니다. 그래서 무리가 있고요. 딱 고장이 많은 한 장비만 타겟으로 데이터분석을 해보자고 해서 골랐던 게 공조기입니다.
공조기가 뭔지 간단하게 설명을 드리면 승강장 내부에 있는 공기와 외부에 있는 신선한 공기를 순환시켜주는 장비입니다.
보이시는 저 사진은 노원역에 환기실에 있는 공조기를 제가 직접 찍은 사진입니다.
여기가 환기실 내부인데 여러분이 생각하시는 것처럼 환기실 내부가 많이 더럽습니다.
공기도 안 좋고 그래서 실제적으로 이거를 유관점검을 통해서 고장이 있는지 없는지를 확인해야 되는데 실제로 잘 유관점검을 안 한다고 들었습니다.
그다음 공조기에 있는 주요 부품인 V벨트를 소개해드리면 V벨트는 저기에 보이시는 오른쪽 하단에 보이시는 저 모터가 있는데 모터의 회전력을 환풍기로 전달해 주는 역할을 하는 부품입니다.
작동하는 걸 보시면 지금 모터가 회전하는 게 보이시죠?
모터의 회전력을 실제 저 환풍기에 있는 저 친구로 회전력을 전달해 주는 부품입니다.
V자 모양으로 생겼다고 해서 V벨트입니다.
어떠한 데이터를 수집을 했는지 그 데이터에 대한 설명을 좀 드리면, 공조기 모터에서 저희는 전류 데이터를 수집했습니다.
공조기가 당연히 작동하려면 전기 에너지가 들어가야겠죠. 그래서 저희는 그냥 자동으로 추출할 수 있는 전류 전기 데이터를 활용했고요. 전류 데이터는 회전력과 밀접한 관계가 있습니다.
저희에게 엑셀 형식으로 데이터를 제공해줬었는데 간단하게 데이터를 찍으면 이런 식으로 나옵니다.
0.5초 단위로 전류 값들이 수집이 되고 실제 그 전류 값이 몇인지 벨류로 보여주는 형식입니다.
노원역 한 장비에 전류 데이터 예시를 보여드리면 다음과 같습니다.
그래프 보시는 것처럼 엑스축은 시간을 의미하고 와이축은 그 시간에 기록된 전류를 보여줍니다. 생각했던 거랑 약간 느낌이 다르다는 생각하실 수 있는데 이 공조기가 24시간 계속 작동하는 게 아니고요.
스케줄에 의해서 자동으로 온/오프 되는 방식입니다.
그래서 보시면 이게 꺼져있는 상태에서는 거의 0 근처, 플랫하게 있다가, 켜지는 시점에 확 뜁니다.
몇 번 정도 가동이 됐는지 실제로 눈으로 보실 수 있겠죠.
저희 연구 목표를 다시 한 번 설명해드리면 이렇게 각 장비마다 수집되는 전류 데이터를 가지고 공조기 모터에 이상을 감지하거나 또는 주요 부품의 상태를 모니터링 하는 모델을 개발하는 것이었습니다.
어떻게 보시면 이게 저희가 추진했던 추진실적이라고 보실 수 있는데, 저희는 총 두 가지의 문제에 접근했습니다.
첫 번째는 공조기에 달려있는 V벨트가 탈락이 되는 상황이 발생합니다.
끊어지거나 또는 슬립이 발생하는데 그러한 탈락상황을 감지하는 알고리즘을 한번 만들어보자, 이게 첫 번째 저희의 목표였고요.
두 번째는 공조기에 있는 주요 부품, V벨트라든지 베어링, 지금 주요 부품들에 컨디션, 상태가 지금 교체가 필요한 상태인지 아닌지 이거를 예측하는 알고리즘을 개발했습니다.
조금 더 디테일하게 설명을 드리면 첫 번째 공조기 모터에 장착된 V벨트의 탈락을 감지하는 알고리즘을 저희가 만들었는데, 벨트가 중간에 끊어지거나 벨트에 슬립이 발생하면 환기실에 전달하는 회전력이 부족해져서 돌아가는 게 덜해집니다. 그래서 V벨트를 한 줄씩 탈락한 상황을 시뮬레이션해서 데이터를 수집했습니다.
한 예를 보시면 지금 딱 다섯줄인가요? 다섯줄의 데이터가 보이는데 0이라고 라벨이 되어 있는 거는 V벨트가 정상적으로 다 장착되어 있는 상태에서 작동한 전류입니다.
그리고 1은 V벨트에 한 1열이 탈락된 상태, 2는 V벨트 두 줄이 탈락된 상태, 어떠신가요? 눈으로 보시는 것처럼 V벨트가 있고 없고에 따라서 명확한 차이가 보여지죠. 그래서 저희는 V벨트가 탈락된 상황을 감지하는 알고리즘을 만들고자 했습니다.
제가 굳이 안 가도 되는데 노원역까지 직접 가서 교통공사 분들과 같이 V벨트를 탈락을 직접 시키고 데이터를 수집
수집했습니다.
제 사진인데 보시면 이 날이 제일 힘들었습니다. 엄청 덥고요.
보시는 것처럼 V벨트가 위험한 장비이다 보니까 커버에 씌워져 있어요. 직접 커버를 떼고 한 줄씩 떼서 데이터를 수집했습니다.
저희가 어떠한 방식으로 문제를 해결했는지 알고리즘을 약간 간단하게 설명을 드리면, 앞에서 보셨던 것처럼 데이터는 켜지는 시점 단위로 딱딱딱딱 세그먼테이션 되어 있지 않습니다.
아까 보시는 것처럼 24시간 동안 쭉 수집된 데이터이기 때문에 이거를 먼저 켜지는 시점 단위로 데이터를 잘라야겠죠.
그래서 저희는 이러한 방법으로 데이터를 잘랐습니다.
조금 더 설명을 드리면 지금 전류가 멈춰있는 상태에서 가동이 되면 딱 피크를 찍고 내려오는 형태인데 언제 피크를 찍는지, 즉 켜지는 시점을 찾기 위해서 우선 시간 index에서 최고 전류 값의 2분의 1이 넘는 구간들을 추출을 했고요.
추출된 구간에서 언제가 켜지는 시점인지 그 시점을 찾기 위해서 index의 디퍼런스가 저기에는 1이라고 돼 있는데 1을 넘는 점을 찾아서 기록했습니다.
켜지는 시점을 추출을 해서 켜지는 시점을 기준으로 해서 플러스, 마이너스, 일정한 시간, 일정한 타임스텝을 해서 켜지는 것을 기준으로 데이터를 잘랐습니다. 나온 결과가 이런 식으로 나옵니다.
언제 이 공조기가 작동을 했는지 그리고 그 구간에 전류 값들이 어떻게 기록이 되었는지를 보여줍니다.
저희에게 제공해 준 데이터가 엑셀이다 보니까 파이썬에서 엑셀을 잘 다룰 수 있는 판다스를 이용해서 간단하게 알고리즘을 짰고요.
그다음은 분할된 데이터를 가지고 실제로 어떤 게 정상상태이고 어떤 게 1열 탈락, 2열 탈락인지 실제로 모델을 만들기 전에 플루팅을 해봤는데 어떤가요? 명확한 차이가 있죠. 정상인 상태랑 V벨트가 탈락된 상태. 이러한 케이스들은 잘 된 케이스들인데 저희가 고장 상황을 하는 모델을 간단한 딥러닝 모델을 만들어서 교통공사에 제공을 했고요.
문제는 이렇습니다.
저희가 공조기에 대한 많은 여러 개의 공조기에 대한 탈락 감지 모델을 개발했는데 첫 번째 문제는 데이터를 학습하기 위해서는 이게 지도학습이다 보니까 데이터를 학습하기 위해서는 실제로 V벨트를 다 탈락한 거를 생성해야 되는데 그거를 전부 하기가 어렵습니다. 실제로 공조기가 8000개가 되고요. 데이터 수집에 한계가 있었고요.
지금 보시는 것처럼 정상, 1열 탈락, 2열 탈락 이런 친구들의 구별이 잘 안 됐죠. 그래서 이러한 한계들이 존재했습니다.
첫 번째 저희가 해결하고자 했던 V벨트 탈락 모델은 여기서 한계를 갖고 마무리를 하고 그다음에는 조금 더 쉬운 문제로 접근을 하기로 했습니다.
쉽다는 말은 무슨 말이냐면 데이터 수집이 용이한 문제로 골랐습니다.
어떤 문제냐면 모터에는 여러 가지 부품들이 존재하겠지요.
V벨트라든지 베어링, 이런 것들이 있는데 이런 부품이 노후화가 되면 교체가 필요한데 부품의 교체가 필요한 상황인지를 판단하는 모델을 개발했습니다.
저희는 부품 교체가 된 시점이 각 부품마다 존재할 텐데 저희가 가정을 한 게, 교체가 일어났어요.
교체가 일어났으면 그 교체 바로 직전은 부품 상태가 제일 안 좋은 상태이고 교체 직후는 부품 상태가 가장 좋은 상태라고 가정을 해서, 부품의 교체 이전과 이후를 구별하는 모델을 만들기로 했습니다.
저희가 만든 모델의 이름이 원-스톱 모델인데 왜 원-스톱 모델이라고 이름을 붙였냐면 앞에서 저희가 했던 문제의 한계점은 각 공조기마다 V벨트 탈락을 감지하기 위해서는 V벨트 전부 다 탈락을 해야 되고 그 공조기마다 모델을 새로 만들어야 되는데 지금 이 부품의 이상을 감지하는 모델은 모든 공조기에 적용할 수 있는 모델입니다.
방법을 설명을 드리면 앞에서 했던 거랑 똑같이 그냥 이렇게 24시간 동안 수집이 되는 데이터를 먼저 똑같이 공조기 작동 시점으로 세그멘테이션을 합니다. 앞에서 했던 방법이랑 유사한 방법을 사용했고요.
교체 날짜가 부품마다 주어져 있는데 그 교체 날짜를 기준으로 교체 이전과 이후를 자동으로 라벨링 해 주는 방법을 알고리즘으로 넣었습니다.
왼쪽에 있는 걸 보시면 군자역에 있는 한 공조기에서 수집된 데이터를 시점 단위로 딴 건데, 교체가 발생을 했죠.
교체 발생 이전과 이후를 자동으로 저렇게 오른쪽과 같이 라벨링을 해줍니다.
이제 어떻게 하냐면 저 자동으로 달린 라벨을 바탕으로 그냥 바이더리 케이스를 하는 거죠. 부품 이전은 교체가 필요한 상태, 이후는 교체가 필요 없는 좋은 상태, 이렇게 해서 모델을 만드는데 제가 설명 드린 것처럼 원-스톱 모델, 즉 공조기에 디펜더드하지 않는 유니버셜한 알고리즘으로 짰고요.
그래서 다양한 공조기와 주요 부품에 대해서 테스트를 해봤는데 보시면 이거는 V벨트에 대한 그림입니다.
교체 전과 후가 빨간색과 파란색으로 라벨링이 되어 있는 거고요.
보시는 것처럼 명확하게 차이가 있는 친구들도 있고 좀 비슷한 친구들도 있습니다.
이거는 베어링의 교체 이전과 이후를 자동으로 라벨링해 주는 거고요.
모델을 개별적, 공조기마다 적용하지 않았는데 정확도가 어느 정도 나왔냐면 보시면 이렇게 나옵니다. V벨트에 대한 결과인데 교체 전과 후 데이터는 왼쪽과 같이 나오고요. 정확도가 만족할만한 수준으로 나오죠.
지금 두 번째 문제는 첫 번째 문제와 다르게 V벨트를 직접 제거하거나 그럴 필요 없이 교체 날짜만 가지고 자동으로 모델을 만들어준 결과입니다.
그래서 좀 적용하기 편하겠지요.
오른쪽에 보시는 정확도라고 하는 친구는 뭐냐면 공조기가 8000대가 되다 보니까 슬림한 모델을 테스트해보고 싶다는 요청이 있어서 모델을 슬림하게 짜서 적용한 결과입니다. 그런데 보시면 정확도가 그렇게 크게 떨어지지 않죠.
이 결과는 베어링에 대한 결과입니다.
평균적으로 한 95% 이상 정확도를 얻었고요.
저희는 케라스, 텐사플로우를 이용한 모델을 짰는데 모델은 그렇게 복잡하지 않고 간단하게 모델을 구성했고요.
모델에 대한 정보는 이렇게 있습니다.
저희는 다양한 테스트를 해봤습니다.
시계열 데이터이다 보니까 RNM 등을 활용해봤는데 속도 면에서 제일 효율적이고 비슷한 것을 채택을 했습니다.
제 발표는 여기까지입니다. 감사합니다.
-(박수)
혹시 질문이 있으신가요?
-(사회자) : 질문은 마이크에 가셔서 하시면 됩니다.
-(질문) : 발표 잘 들었습니다. 그런데 정확도가 어떤 거를 말씀하시는지 궁금하거든요.
테스트 트레이닝셋을 나눈 다음에 트레이닝셋으로 학습한 것인지 아니면..
그러면 저거를 가지고 실제 돌아가는 게 실제적용예측은?
-(김민중) : 실제 이 솔루션을 탑재하기 위해서는 과정을 거치는데 저희는 파이썬 안에서만 테스트를 한 결과고요. 실제로 솔루션을 탑재하기까지는 시간이 걸리는 것으로 알고 있습니다.
-(질문) : 마지막 질문인데 정확도를 나눌 때 기준이 있잖아요.
맞다, 틀리다의 기준이 뭔가요?
-(김민중) : 저희는 어쨌든 교체 시점이라고 하는 날짜를 가지고 있고, 그 이전과 이후를 분리하는, 이진 분류 모델을 짰기 때문에 이전을 제대로 예측했으면 맞는 거고요. 이후를 이후로 예측했으면 맞는 거고요. 그런 식으로 간단하게 이진 분류 모델이라고 생각하시면 됩니다.
-(질문) : 발표 잘 들었습니다.
서울교통공사에서 삼바 시스템에 대한 API나 자체 제작해서 팀에게 준 건가요?
-(김민중) : 아닙니다. 서울교통공사도 본인들이 개발할 수 있는 인력이 없다 보니까 용역을 줘서 삼바 시스템을 개발한 걸로 알고 있고요.
저희는 교통공사와 이런 작업들, 이런 데이터 분석을 해서 실제 이거를 적용하는 데는 이 업체가, 이거를 개발한 업체가 중간에 들어가서 적용하는 걸로 알고 있습니다.
그래서 어떠한 언어로 했는지는 저희는 모릅니다.
-(질문) : 기술 자문 같은 것도 공사나 용역 업체에서 동시에 조달을 받은 거고요?
-(김민중) : 저희 업무가 수학을 가지고 수학적인 지원을 해 주자라는 목적을 가지고 설립된 센터이다 보니까 무료로 요청이 있으면 자문을 해줍니다.
-(질문) : 정확도가 가장 낮았을 때에는 몇 프로 정도 나왔나요?
-(김민중) : 정확도가 가장 낮은 케이스는 여기에 85% 정도 나왔습니다.
그런데 이게 지금 목동역인데 이거는 왼쪽에 보이시는 정확도는 유니버셜한, 모델튜닝 이런 거를 재구성을 전혀 하지 않고 그냥 처음 짰던 모델로 돌렸던 결과고요.
그런데 실제로 저 목동역을 타겟으로 해서 모델을 다시 한 번 만들어보자, 라고 했을 때 저희가 90% 넘는 정확도까지 얻었습니다.
그런데 어쨌든 그냥 단일 모델로 적용했을 때는 85% 정도 정확도가 나왔습니다.
-(질문) : 마지막 질문인데요.
공조기 수명이 다해서 새로운 공조기를 설치했을 때도 그 값이 서로 다를 수도 있잖아요.
이런 경우에도 기존에 개발했던 모델에 사용할 수 있나요?
-(김민중) : 아마 모델을 바꿔야 된다고 저는 생각합니다.
저희가 이 전류 데이터 말고 다른 진동 데이터도 트라이를 해봤는데 옆 장비에 대한 간섭이라든지 공조기 교체, 이런 것들이 발생하게 되면 데이터들이 정말 완전 달라지는 그런 케이스들이 발생해서 그러한 케이스는 특수한 케이스로 따로 봐야 된다고 생각합니다.
-(질문) : V벨트를 교체했을 때도, 특수한 케이스도 발생할 수 있는 거죠?
-(김민중) : 예, 맞습니다. V벨트랑 베어링 같이 교체했을 때는 어떠한 상관관계가 발생하는지 그러한 이슈들이 있었는데 그러한 이슈들은 좀 뒤로 미루어 놓은 상태입니다.
-(질문) : 잘 들었습니다.
-(사회자) : 잠시만요.
발표 시간이 지금 종료가 되어서 더 질문이 있으신 분들은 2층에 열린 공간을 활용하실 수 있습니다. 발표자 분께 요청하셔서 열린 공간에서 조금 더 남은 토론을 진행할 수 있도록 잘 이끌어주셨으면 좋겠습니다.
발표해 주신 김민중 님께 감사드립니다. 박수 부탁드립니다.
-(박수)
지금부터 30분간 쉬는 시간을 가지려고 합니다. 30분 후에 101호에서 다음 세션 진행하도록 하겠습니다.

<끝>